{% extends "/materialize/base.html" %}
{% block title %}<title>Invictus » Residencial</title>{% endblock %}


   
{% block page_css %}
    <!-- INCLUDED PLUGIN CSS ON THIS PAGE -->
    <link href="/{{theme}}/materialize/css/plugins/perfect-scrollbar/perfect-scrollbar.css" type="text/css" rel="stylesheet" media="screen,projection">
    <link href="/{{theme}}/materialize/css/plugins/jvectormap/jquery-jvectormap.css" type="text/css" rel="stylesheet" media="screen,projection">
    <link href="/{{theme}}/materialize/css/plugins/chartist-js/chartist.min.css" type="text/css" rel="stylesheet" media="screen,projection">
    <style type="text/css">
        .cooling{
            background-color: #389BE4;
        }
        .heating{
            background-color: #E43E53;
        }
        .appliances{
            background-color: #71BB32;
        }
        .entertainment{
            background-color: #652ABC;
        }
        .lighting{
            background-color: #DDAA2E;
        }
        .others{
            background-color: #9A9A9A;
        }
    </style>
{% endblock %}




{% block page_content %}
<div class="section">
    <div class="container">
        <!--chart dashboard start-->
        {% if data_override %}
        <div id="chart-dashboard" style="opacity: 0.3;">
            <div class="row">
                <div class="col l4 s12 center" style="border-right: 1px dotted rgb(238, 238, 238);">
                    <h5 class="grey-text" style="margin-bottom:-10px;">Último recibo</h5>
                    <p class="grey-text text-lighten-1" style="font-weight: 100;margin-left: 10%;margin-right: 10%;">de May 2015</p>
                    <div class="row">
                        <h4 class="card-stats-number">$196</h4>                            
                    </div>
                    <p class="grey-text text-lighten-1" style="font-weight: 100;margin-left: 10%;margin-right: 10%;">Tu consumo del mismo periodo del año pasado fue de $225</p>                        
                    <div class="row">
                        <button onclick="window.open('{{ uri_for("materialize-compare") }}', '_top')" class="btn white orange-text text-darkem-2 waves-effect waves-light" name="action" style="margin-bottom: 18px;margin-top: 10px;" disabled="">Compárate con vecinos
                              <i class="mdi-content-send right"></i>
                        </button>
                    </div>
                </div>

                <div class="col l4 s12 center" style="border-right: 1px dotted rgb(238, 238, 238);">
                    <h5 class="grey-text">Ahorro</h5>
                    <div class="row">
                        <img src="/default/materialize/images/moods/moods-02.png" style="height: 70px;margin-top: 10px;margin-bottom: -7px;">
                        <h4 class="card-stats-number" style="color:#3B9C2C">$29</h4>
                    </div>
                    <div class="row">
                        
                          <p style="color:#3B9C2C; font-weight: 100;margin-left: 10%;margin-right: 10%;">¡Excelente! Este país debería tener más personas como tú, {{name}}!</p>                        
                        
                    </div>
                </div>

                <div class="col l4 s12 center" style="border-right: 1px dotted rgb(238, 238, 238);">
                    <h5 class="grey-text" style="margin-bottom:-10px;">Próximo recibo</h5>
                    <p class="grey-text text-lighten-1" style="font-weight: 100;margin-left: 10%;margin-right: 10%;">estimado para Jun 2015</p>
                    <div class="row">
                        <h4 class="card-stats-number tooltipped" style="color:#EDB011;" data-position="top" data-delay="50" data-tooltip="¡No rebases $394!">$393</h4>                            
                    </div>
                    <p class="grey-text text-lighten-1" style="font-weight: 100;margin-left: 10%;margin-right: 10%;">Al día de hoy llevas <span id="estimatedMoney">$334.98</span>, <br> última actualización: May 29, 2015</p>                        
                    <div class="row">
                        <a id="modal1_trigger" class="waves-effect waves-light btn modal-trigger left" href="#modal1" style="display:none;max-width:166px;"></a>
                        <button onclick="modal1_trigger.click()" class="btn white orange-text text-darkem-2 waves-effect waves-light" name="action" style="margin-bottom: 18px;margin-top: 10px;" disabled="">Actualizar ahora
                              <i class="mdi-content-send right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div id="chart-dashboard">
            <div class="row">
                <div class="col l4 s12 center" style="border-right: 1px dotted rgb(238, 238, 238);">
                    <h5 class="grey-text" style="margin-bottom:-10px;">Último recibo</h5>
                    <p class="grey-text text-lighten-1" style="font-weight: 100;margin-left: 10%;margin-right: 10%;">de {{period}}</p>
                    <div class="row">
                        <h4 class="card-stats-number">${{period_bill}}</h4>                            
                    </div>
                    <p class="grey-text text-lighten-1" style="font-weight: 100;margin-left: 10%;margin-right: 10%;">Tu consumo del mismo periodo del año pasado fue de ${{last_bill}}</p>                        
                    <div class="row">
                        <button onclick="window.open('{{ uri_for("materialize-compare") }}', '_top')" class="btn white orange-text text-darkem-2 waves-effect waves-light" name="action" style="margin-bottom: 18px;margin-top: 10px;">Compárate con vecinos
                              <i class="mdi-content-send right"></i>
                        </button>
                    </div>
                </div>

                <div class="col l4 s12 center" style="border-right: 1px dotted rgb(238, 238, 238);">
                    <h5 class="grey-text">Ahorro</h5>
                    <div class="row">
                        <img src="/default/materialize/images/moods/moods-0{{mood_icon}}.png" style="height: 70px;margin-top: 10px;margin-bottom: -7px;">
                        <h4 class="card-stats-number" style="color:{{mood_color}}">${{period_savings}}</h4>
                    </div>
                    <div class="row">
                        {% if mood_icon < 4 %}
                          <p style="color:{{mood_color}}; font-weight: 100;margin-left: 10%;margin-right: 10%;">¡Excelente, este país debería tener más personas como tú, {{name}}!</p>                        
                        {% elif mood_icon >= 4 and mood_icon < 7 %}
                          <p style="color:{{mood_color}}; font-weight: 100;margin-left: 10%;margin-right: 10%;">Bien {{name}}, te mantuviste en tu ritmo de gastos.</p>                        
                        {% elif mood_icon >= 7 %}
                          <p style="color:{{mood_color}}; font-weight: 100;margin-left: 10%;margin-right: 10%;">Mmmm...estás pagando más que el año pasado. ¿Qué está pasando {{name}}?</p>                        
                        {% endif %}
                    </div>
                </div>

                <div class="col l4 s12 center" style="border-right: 1px dotted rgb(238, 238, 238);">
                    <h5 class="grey-text" style="margin-bottom:-10px;">Próximo recibo</h5>
                    <p class="grey-text text-lighten-1" style="font-weight: 100;margin-left: 10%;margin-right: 10%;">estimado para {{next_period}}</p>
                    <div class="row">
                        <h4 class="card-stats-number tooltipped" style="color:{{est_mood_color}};" data-position="top" data-delay="50" data-tooltip="{{est_mood_msg}}">${{f_estimated_bill}}</h4>                            
                    </div>
                    <p class="grey-text text-lighten-1" style="font-weight: 100;margin-left: 10%;margin-right: 10%;">Al día de hoy llevas <span id="estimatedMoney">${{estimated_bill}}</span>, <br> última actualización: {{last_update}}</p>                        
                    <div class="row">
                        <a id="modal1_trigger"class="waves-effect waves-light btn modal-trigger left" href="#modal1" style="display:none;max-width:166px;"></a>
                        <button onclick="modal1_trigger.click()" class="btn white orange-text text-darkem-2 waves-effect waves-light" name="action" style="margin-bottom: 18px;margin-top: 10px;">Actualizar ahora
                              <i class="mdi-content-send right"></i>
                        </button>
                    </div>
                </div>
                <div id="modal1" class="modal">
                  <i class="mdi-navigation-close right blue-grey-text text-lighten-4 modal-action modal-close"></i><div class="modal-content blue-grey-text center">
                    <p>Envíanos una foto de tu medidor y obtén tu gasto en pesos.</p>
                    <div class="divider"></div>
                    <form id="umr_picture_form" action="/umr/upload/" enctype="multipart/form-data" method="post">
                          <div class="file-field input-field center">
                            <img id="blah" src="/{{theme}}/materialize/images/umr_example.png" height="200" style="border-radius: 4px;"/><br><br>
                            <div class="btn" style="position: relative;">
                              <span>Seleccionar archivo</span>
                              <input type="file">
                            </div>
                          </div>                    
                    </form> 
                  </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!--chart dashboard end-->

        <div class="divider"></div>

        <!--card widgets start-->
        <div id="card-widgets">
            <h4 class="header">Destacados</h4>
            <div class="row">
                <div class="col s12 m8" style="margin-top: 8px;">
                   <div class="row center">
                        {% if total_products > 0 %}
                            <!-- <div class="col s12 m4">
                                <div class="card">
                                  <div class="card-image waves-effect waves-block waves-light">
                                    <img class="activator" src="/default/materialize/images/office.jpg" alt="office">
                                  </div>
                                  <div class="card-content" style="background:white;">
                                    <span class="card-title activator grey-text text-darken-4">Vendor A <i class="mdi-navigation-more-vert right"></i></span>
                                    <p><a href="#">This is a link</a></p>
                                  </div>
                                  <div class="card-reveal" style="display: none; transform: translateY(0px);">
                                    <span class="card-title grey-text text-darken-4">Vendor A <i class="mdi-navigation-close right"></i></span>
                                    <p>Here is some more information about this product that is only revealed once clicked on.</p>
                                  </div>
                                </div>
                            </div> -->
                        {% else %}
                          <div class="col s12">
                              <div class="card">
                                <div class="card-image waves-effect waves-block waves-light" style="max-height:200px;">
                                  <img class="activator" src="/default/materialize/images/office.jpg" alt="office" style="  -webkit-filter: grayscale(100%);">
                                </div>
                                <div class="card-content" style="background:white;">
                                  <span class="card-title activator grey-text text-darken-4">Muy pronto... <i class="mdi-navigation-more-vert right"></i></span>
                                </div>
                                <div class="card-reveal" style="display: none; transform: translateY(0px);">
                                  <span class="card-title grey-text text-darken-4">Los que necesitas, aquí.<i class="mdi-navigation-close right"></i></span>
                                  <br>
                                  <p>Muy pronto este espacio será utilizado para que puedas adquirir productos validados por Invictus y filtrados por la misma comunidad
                                     que nos conforma. Así, aseguraremos que tengas todo lo que necesitas al alcance para que pagues menos luz. <br><br> ¡ Gracias por tu paciencia !
                                  </p>
                                </div>
                              </div>
                          </div>
                        {% endif %}
                   </div>
                </div>

                <div class="col s12 m4">
                    <div class="col s12">
                        <ul id="task-card" class="collection with-header" style="max-height: 300px;overflow: scroll;">
                            <li class="collection-header">
                                <h5 class="task-card-title cyan-text">Acciones<span class="new badge white blue-text">{{total_tips}}</span></h5>
                                <p class="task-card-date cyan-text" style="max-width: 300px;font-weight: 100;font-size: 14px;">¡Manos a la obra! Pequeñas acciones con grandes ahorros.</p>
                            </li>
                            {% for cartodb_id, title, category, categoria, status in tips %}
                                <li class="collection-item dismissable">
                                    <input type="checkbox" id="task{{cartodb_id}}" {{status}}/>
                                    <label for="task{{cartodb_id}}">{{title}}<a href="{{ uri_for("materialize-tips") }}?id={{cartodb_id}}" class="secondary-content"><span class="ultra-small">Ver más</span></a>
                                    </label>
                                    <span class="task-cat {{category}}">{{categoria}}</span>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>

                    <div class="col s12">
                        <div class="card cyan center white-text">
                            <h6 class="task-card-title"><i class="mdi-image-wb-sunny"></i>  Calcula tus paneles solares</h6>
                            <button onclick="window.open('{{ uri_for("materialize-solar") }}', '_top')" class="btn cyan waves-effect waves-light" name="action" style="margin-bottom: 18px;margin-top: 10px;">Calcular
                                  <i class="mdi-content-send right"></i>
                            </button>
                        </div>
                    </div>

                    <div class="col s12">
                        <div id="profile-card" class="card">
                            <div class="card-image waves-effect waves-block waves-light">
                                <img class="activator" src="/{{theme}}/materialize/images/users_bg.png" alt="user background">
                            </div>
                            <div class="card-content">
                                {% if has_picture %}
                                  <img src="/img/" alt="" class="circle responsive-img activator card-profile-image" style="width:95px!important;">
                                {% else %}
                                  <img src="/{{theme}}/materialize/images/ninja.png" alt="" class="circle responsive-img activator card-profile-image" style="background-color: white;border: 2px solid white;">
                                {% endif %}
                                <a class="btn-floating activator btn-move-up waves-effect waves-light darken-2 right">
                                    <i class="mdi-editor-mode-edit"></i>
                                </a>

                                <span class="card-title activator grey-text text-darken-4">{{name}} {{last_name}}</span>
                                <p><i class="mdi-action-perm-identity cyan-text text-darken-2"></i> {{role}}</p>
                                <p><i class="mdi-action-perm-phone-msg cyan-text text-darken-2"></i> {{phone}}</p>
                                <p><i class="mdi-communication-email cyan-text text-darken-2"></i> {{email}}</p>

                            </div>
                            <div class="card-reveal">
                                <span class="card-title grey-text text-darken-4">{{name}} {{last_name}}<i class="mdi-navigation-close right"></i></span>
                                <p style="padding-bottom:10px;">Esta es tu información de contacto.</p>
                                <p><i class="mdi-action-perm-identity cyan-text text-darken-2"></i> {{role}}</p>
                                <p><i class="mdi-action-perm-phone-msg cyan-text text-darken-2"></i> {{phone}}</p>
                                <p><i class="mdi-communication-email cyan-text text-darken-2"></i> {{email}}</p>
                                <p><i class="mdi-social-cake cyan-text text-darken-2"></i> {{birth}}</p>
                                <p class="center">
                                  <button onclick="window.open('{{ uri_for("materialize-settings-profile") }}', '_top')" class="btn white orange-text text-darkem-2 waves-effect waves-light" name="action" style="margin-bottom: 18px;margin-top: 10px;">Editar</button>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--card widgets end-->
    </div>
</div>
{% endblock %}


<!-- Remove floating button from home -->
{% block page_floatings %}
{% endblock %}



{% block page_footer %}
{% endblock %}



{% block page_scripts %} 
    <!-- chartjs -->
    <script type="text/javascript" src="/{{theme}}/materialize/js/plugins/chartjs/chart.min.js"></script>

    <!-- sparkline -->
    <script type="text/javascript" src="/{{theme}}/materialize/js/plugins/sparkline/jquery.sparkline.min.js"></script>
    <script type="text/javascript" src="/{{theme}}/materialize/js/plugins/sparkline/sparkline-script.js"></script>
    
    <!--jvectormap-->
    <script type="text/javascript" src="/{{theme}}/materialize/js/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
    <script type="text/javascript" src="/{{theme}}/materialize/js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
    <script type="text/javascript" src="/{{theme}}/materialize/js/plugins/jvectormap/vectormap-script.js"></script>
    {% if not data_override %}
    <script type="text/javascript">
        var updateInterval = 2;

        function estimate(){
            var timeout = new Date();
            secSet = (timeout.getSeconds()+timeout.getHours()*60*60+timeout.getMinutes()*60)/updateInterval;
            var fracDay = secSet/((24*60*60)/updateInterval);
            _estimatedMoney = ({{estimated_bill}} + {{avg_day}}*fracDay);
            estimatedMoney.innerHTML = '$' + _estimatedMoney.toFixed(2);
        }

        $("#umr_picture").change(function(){
            $( '#umr_picture_form' ).submit();
        });

        $(function () {
            setInterval(function () {estimate()}, updateInterval*1000);
        });
    </script>
    {% endif %}

{% endblock %}
